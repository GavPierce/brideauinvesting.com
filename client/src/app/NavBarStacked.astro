---
---

<script>
	let addChannelButton = document.getElementById('add-channel');
	let submitButton = document.getElementById('submit');
	let modal = document.getElementById('add-channel-modal');
	let pinError = document.getElementById('pin-error');
	let successMessage = document.getElementById('success-message');
	if (addChannelButton) {
		addChannelButton.addEventListener('click', () => {
			if (modal != null) {
				modal.classList.toggle('show-modal');
				modal.classList.toggle('hide-modal');
			}
		});
	}

	if (modal) {
		modal.addEventListener('click', (event) => {
			if (modal != null && event.target === modal) {
				modal.classList.toggle('show-modal');
				modal.classList.toggle('hide-modal');

				if (pinError && successMessage) {
					pinError.innerHTML = '';
					successMessage.innerHTML = '';
				}
			}
		});
	}
	if (submitButton) {
		let channelList = document.getElementById(
			'channel-list-add',
		) as HTMLInputElement;
		let pin = document.getElementById('pin') as HTMLInputElement;

		submitButton.addEventListener('click', async () => {
			let channelListValue = channelList?.value;
			let pinValue = pin?.value;
			if (pinValue == '') {
				if (pinError) {
					pinError.innerHTML = 'Please enter authorization pin';
				}
			} else {
				let cleanedChannelList = cleanChannelList(channelListValue);
				const response = await fetch(`https://api.brideauinvesting.com/api/addChannels`, {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify({
						channels: cleanedChannelList,
						pin: pinValue,
					}),
				});

				if (response.ok) {
					let data = await response.json();
					if (successMessage) {
						successMessage.innerHTML =
							'Success! ' + data.channels.length + ' channels added';
					}
					if (pinError) {
						pinError.innerHTML = '';
					}
				} else {
					let errorText = await response.text();
					if (pinError) {
						pinError.innerHTML = errorText;
					}
				}
			}
		});
	}

	let cleanChannelList = (list: string) => {
		// remove all $
		list = list.replace(/\$/g, '');
		// all lower case
		list = list.toLowerCase();
		// remove any spaces
		list = list.replace(/\s/g, '');
		// split into array
		// return array of channels
		return list.split(',');
	};
</script>
<style>
	.show-modal {
		display: block;
	}
	.hide-modal {
		display: none;
	}
</style>

<nav
	class="sticky top-0 z-50 w-full border-b border-gray-200 bg-white/80 backdrop-blur supports-backdrop-blur:bg-white/70 sm:py-2 dark:bg-gray-800/80 dark:supports-backdrop-blur:bg-gray-800/70 dark:border-gray-700"
>
	<div class="container p-3 px-5 mx-auto">
		<div class="flex items-center justify-between">
			<div class="flex items-center justify-center gap-3">
				<!-- <img src="./brideau-logo.svg" alt="Brideau Investing" class="h-10 w-10" /> -->
				<span
					class="self-center text-2xl md:text-3xl font-extrabold tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-indigo-600 dark:from-blue-400 dark:to-indigo-400"
					>EP Marketing and Research</span
				>
			</div>
			<button
				class="inline-flex items-center gap-2 rounded-lg bg-gradient-to-r from-blue-600 to-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:from-blue-500 hover:to-indigo-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800"
				id="add-channel"
			>
				<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-4 w-4">
					<path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
				</svg>
				Add Channel
			</button>
		</div>
	</div>
	<div
		class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 hide-modal"
		id="add-channel-modal"
		role="dialog"
		aria-modal="true"
	>
		<div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-xl w-11/12 max-w-lg m-auto mt-20">
			<h2 class="text-xl font-bold mb-2 text-gray-900 dark:text-white">Add New Channel</h2>
			<p class="text-sm text-gray-500 dark:text-gray-400 mb-4">Add one or many channels, comma separated. "$" symbol is optional.</p>
			<label for="channel-list-add" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Channels</label>
			<input
				type="text"
				class="border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 placeholder-gray-400 dark:placeholder-gray-400 px-3 py-2 rounded-md w-full focus:outline-none focus:ring-2 focus:ring-blue-500"
				placeholder="e.g. $hmr, bbb, utc, $lmr"
				id="channel-list-add"
				autofocus
			/>
			<div class="mt-4 flex items-center gap-4">
				<div class="flex-1">
					<label for="pin" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Authorization PIN</label>
					<input
						type="password"
						class="border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 placeholder-gray-400 dark:placeholder-gray-400 px-3 py-2 rounded-md w-full focus:outline-none focus:ring-2 focus:ring-blue-500"
						placeholder="Enter PIN"
						id="pin"
					/>
					<span class="block mt-1 text-red-500 text-sm italic font-normal" id="pin-error"></span>
				</div>
				<div class="pt-6">
					<button
						class="inline-flex items-center gap-2 rounded-lg bg-gradient-to-r from-blue-600 to-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:from-blue-500 hover:to-indigo-500 focus:outline-none focus:ring-2 focus:ring-blue-500"
						id="submit">Submit</button
					>
				</div>
			</div>
			<span class="block mt-3 text-green-600 dark:text-green-400 text-sm font-semibold" id="success-message"></span>
		</div>
	</div>
</nav>
